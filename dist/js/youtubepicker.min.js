/*!
 * youtubepicker.js - v2.0.0 - 2016
 * http://github.com/airesvsg/youtubepicker
 * Copyright (c) 2016 Aires Goncalves;
 * Licensed MIT
 */
!function(e){var t="https://www.googleapis.com/youtube/v3/",i={init:function(t,i){var n=this;n.$field=e(t),n.id="youtubepicker-"+(new Date).getTime(),n.options=e.extend({},e.fn.youtubepicker.options,n.$field.data(),i),n.field_init()},field_init:function(){var t=this,i={};t.options.cloneField&&(t.clone=t.$field.clone(!0),t.$field.removeAttr("name"),t.clone.insertAfter(t.$field),t.clone.hide().removeAttr("class id").addClass("youtubepicker-cloned-field")),e(t.template("panel")).insertAfter(t.$field),t.$panel=e("#"+t.id),t.$content=t.$panel.find(".youtubepicker-content"),i.x=t.$field.offset().left-t.$panel.parent().offset().left,i.x+=parseInt(t.options.offset.x,10)||0,i.y=parseInt(t.options.offset.y,10)||0,t.$panel.css({"margin-left":i.x,"margin-top":i.y}),t.field_events(),t.buttons_events(),t.scroller()},field_events:function(){var t,i,n=this;n.$field.on("keyup",function(){n.term=e(this).val(),clearTimeout(i),n.term.length?n.term.length>=n.options.minChar&&t!==n.term&&(i=setTimeout(function(){t=n.term,n.$content.empty(),n.search()},1e3*parseInt(n.options.searchDelay,10))):(n.$content.empty(),n.$panel.removeClass("youtubepicker-loading"),n.scroller("update"))}).on("focus",function(){e(".youtubepicker.panel").hide(),n.$panel.is(":visible")||n.$panel.show()}).on("blur",function(){n.$panel.is(":hover")||n.$panel.hide()})},buttons_events:function(t){var i=this;"items"===t?(i.$panel.find(".youtubepicker-select-btn").off().on("click",function(t){t.preventDefault();var n=e(this).closest(".youtubepicker-item").data("youtubepicker-item-data");i.options.cloneField&&(i.clone.val(n.vid),n=e.extend({},n,{clone:i.clone,term:i.term})),i.$field.trigger("itemSelected",n),i.$panel.hide()}),i.$panel.find(".youtubepicker-preview-btn").off().on("click",function(t){t.preventDefault();var n=e(this).closest(".youtubepicker-item"),o=n.data("youtubepicker-item-data"),r=i.$panel.find(".youtubepicker-preview");r.addClass("show"),r.find(".youtubepicker-player").html(i.template("player",o)),i.$panel.find(".youtubepicker-preview-btn").removeClass("current"),n.addClass("current")})):(i.$panel.find(".youtubepicker-preview-close-btn").off().click(function(e){e.preventDefault();var t=i.$panel.find(".youtubepicker-preview");t.hasClass("show")&&t.removeClass("show"),t.find(".youtubepicker-player").empty(),i.$panel.find(".youtubepicker-preview-btn.current").removeClass("current")}),i.$panel.find(".youtubepicker-preview-select-btn").off().click(function(e){e.preventDefault(),i.$panel.find(".youtubepicker-preview-close-btn").click(),i.$panel.find(".youtubepicker-item.current").find(".youtubepicker-select-btn").click()}))},scroller:function(t){var i=this,n=i.$panel.find(".nano");e.isFunction(n.nanoScroller)&&("update"===t?i.$panel.find(".nano").nanoScroller():n.nanoScroller(setTimeout.nanoScroller).on("scrollend",function(){i.search()}))},template:function(e,t){var i=this,n="",o="";return"panel"===e?(i.options.preview&&(o='<div class="youtubepicker-preview"><div class="youtubepicker-actions"><a href="#" class="youtubepicker-preview-select-btn">'+i.options.language.buttons.select+'</a><a href="#" class="youtubepicker-preview-close-btn">'+i.options.language.buttons.close+'</a></div><div class="youtubepicker-player"></div></div>'),n='<div id="'+i.id+'" class="youtubepicker youtubepicker-panel"><div class="youtubepicker-wrap"><div class="youtubepicker-results nano"><div class="youtubepicker-content nano-content"></div><div class="youtubepicker-loader">'+i.options.language.labels.loading+'</div><div class="youtubepicker-no-records">'+i.options.language.labels.noRecords+"</div></div>"+o+"</div></div>"):"item"===e?(i.options.preview&&(o='<a href="#" class="youtubepicker-preview-btn">'+i.options.language.buttons.preview+"</a>"),n='<div class="youtubepicker-item youtubepicker-item-'+t.vid+'"><div class="youtubepicker-thumbnail"><img src="'+t.thumb+'"></div><div class="youtubepicker-info"><p class="youtubepicker-title">'+t.title+'</p><p class="youtubepicker-description">'+t.description+'</p></div><div class="youtubepicker-actions" data-vid="'+t.vid+'">'+o+'<a href="#" class="youtubepicker-select-btn">'+i.options.language.buttons.select+"</a></div></div>"):"player"===e&&(n='<iframe type="text/html" width="100%" height="100%" src="http://www.youtube.com/embed/'+t.vid+'?autoplay=1&showsearch=0&iv_load_policy=3&fs=0&rel=0&loop=0" frameborder="0"/>'),n},populate:function(t){var i=this,n=t.items||[],o=i.$panel.find(".youtubepicker-no-records");if(n.length){o.hide();for(var r in n)e(".youtubepicker-item-"+n[r].id.videoId).length||(t={vid:n[r].id.videoId,title:n[r].snippet.title,description:n[r].snippet.description,thumb:n[r].snippet.thumbnails["default"].url},i.$content.append(i.template("item",t)),e.data(i.$panel.find(".youtubepicker-item:last")[0],"youtubepicker-item-data",t))}else o.show();i.$panel.removeClass("youtubepicker-loading"),i.scroller("update"),i.buttons_events("items")},search:function(){var i=this,n={key:i.options.key,part:"snippet",type:"video",pageToken:i.pageToken,q:i.term};n=e.extend({},i.options.searchParams,n),i.$panel.addClass("youtubepicker-loading"),i.$field.trigger("loadInit",n),e.getJSON(t+"search",n).done(function(e){i.pageToken=e.nextPageToken,i.populate(e),i.$field.trigger("loadComplete",e)}).fail(function(e){i.$field.trigger("loadError",e)})}};e.fn.youtubepicker=function(t){return this.each(function(){var n=Object.create(i);n.init(this,t),e.data(this,"youtubepicker",n)})},e.fn.youtubepicker.options={key:"AIzaSyAuHQVhEmD4m2AXL6TvADwZIxZjNogVRF0",prefix:"youtubepicker",minChar:3,searchDelay:2,preview:!0,cloneField:!0,offset:{x:0,y:0},language:{buttons:{preview:"Preview",select:"Select",close:"&times;"},labels:{views:"Views",noRecords:"No records",loading:"Loading..."}},searchParams:{maxResults:50,order:"relevance"}}}(jQuery,window,document);