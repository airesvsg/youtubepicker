!function(e){function i(e,i){var t="",a=i.prefix,n=i.language;switch(e){case"panel":t='<div id="'+a+"-"+i.id+'" class="'+a+'"><div class="'+a+'-wrap"><div class="'+a+'-results nano"><div class="'+a+'-content nano-content"></div><div class="'+a+'-no-records">'+n.labels.noRecords+'</div></div><div class="'+a+'-preview"><a herf="javascript:;" class="'+a+'-btn-close-player">'+n.buttons.close+'</a><div class="'+a+'-player"></div></div></div></div>';break;case"item":t='<div class="'+a+'-item"><div class="'+a+'-thumbnail"><p class="'+a+'-duration">'+i.duration.hours+":"+i.duration.minutes+":"+i.duration.minutes+'</p><img src="http://i.ytimg.com/vi/'+i.vid+'/default.jpg"/></div><div class="'+a+'-info"><p class="'+a+'-title">'+i.title+'</p><div class="'+a+'-rating"><div class="'+a+'-likes" style="width:'+i.likes+'%"></div></div><div class="'+a+'-view-count">'+i.views+" <span>"+n.labels.views+'</span></div></div><div class="'+a+'-actions"><a class="'+a+'-preview-btn" href="javascript:;">'+n.buttons.preview+'</a><a class="'+a+'-select-btn" href="javascript:;">'+n.buttons.select+"</a></div></div>";break;case"iframe":t='<iframe width="100%" height="100%" src="https://www.youtube.com/embed/'+i.vid+'?autoplay=1" frameborder="0" allowfullscreen></iframe>'}return t}function t(e){e=parseInt(e,10);var i=Math.floor(e/3600),t=e%3600,a=Math.floor(t/60);return e=Math.round(t%60),{hours:(10>i?"0":"")+i,minutes:(10>a?"0":"")+a,seconds:(10>e?"0":"")+e}}function a(i,t,a,n){a=parseInt(a,10),t=a*(parseInt(t,10)-1)+1;var s=i.val(),r={q:s,v:2,format:5,"max-results":a,"start-index":t,alt:"jsonc"},o="http://gdata.youtube.com/feeds/api/"+(n?"users/"+n+"/uploads":"videos");i.trigger("loadInit",{field:i}),e.getJSON(o,r,function(t){t=e.extend({},t,{field:i,hasItems:Boolean(t.data.items)}),i.trigger("loadComplete",t)}).fail(function(){i.trigger("loadError",{field:i})})}function n(a){if(a.field){var n=a.field.data("YPFieldData"),s=e("#"+n.prefix+"-"+n.ypid),r=s.find("."+n.prefix+"-content"),o=s.find("."+n.prefix+"-no-records");if(a.hasItems){var l,d,c=a.data;o.hide();for(l in c.items)c.items.hasOwnProperty(l)&&(d=c.items[l],d={title:d.title,vid:d.id,views:d.viewCount,thumb:d.thumbnail.sqDefault,likes:Math.round(100*d.likeCount/d.ratingCount),prefix:n.prefix,language:n.language,duration:t(d.duration)},r.append(i("item",d)),e.data(s.find("."+n.prefix+"-item:last")[0],"YPItemData",d))}else o.show();s.find(".nano").nanoScroller()}}function s(e){var i=e.attr("class"),t=e.find("."+i+"-preview");t.hasClass("show")&&t.removeClass("show"),e.find("."+i+"-player").empty()}var r={prefix:"youtubepicker",minChar:3,searchDelay:1e3,channel:"",preview:!0,itemsPerPage:50,offset:{x:0,y:0},nanoScroller:{preventPageScrolling:!0},cloneField:!0,language:{buttons:{preview:"Preview",select:"Select",close:"&times;"},labels:{views:"Views",noRecords:"No records"}}};e.fn.youtubepicker=function(t){var o=e.extend({},r,e.fn.youtubepicker.options,t);return this.each(function(){var t=e(this),r=(new Date).getTime(),l=1,d=null,c="",f=i("panel",{id:r,prefix:o.prefix,language:o.language});if(o.cloneField){var u=t.clone(!0);t.removeAttr("name"),u.insertAfter(t),u.hide().removeAttr("class")}e.data(t[0],"YPFieldData",{ypid:r,prefix:o.prefix,language:o.language}),e(f).insertAfter(t),f=e("#"+o.prefix+"-"+r),o.offset.x&&f.css("margin-left",parseInt(o.offset.x,10)+"px"),o.offset.y&&f.css("margin-top",parseInt(o.offset.y,10)+"px"),e.isFunction(f.find(".nano").nanoScroller)&&f.find(".nano").nanoScroller(setTimeout.nanoScroller).on("scrollend",function(){l++,a(t,l,o.itemsPerPage,o.channel)}),t.on("keyup",function(){var i=e(this),n=i.val(),r=f.find("."+o.prefix+"-content");clearTimeout(d),n.length?n.length>=o.minChar&&c!==n&&(s(f),d=setTimeout(function(){c=n,a(t,l,o.itemsPerPage,o.channel),r.empty()},o.searchDelay)):r.empty()}).on("focus",function(){e("."+o.prefix).hide(),f.is(":visible")||f.show()}).on("blur",function(){f.is(":hover")||f.hide()}).on("loadComplete",function(a,s){n(s),f.find("."+o.prefix+"-select-btn").on("click",function(){var i=e(this).closest("."+o.prefix+"-item").data("YPItemData");o.cloneField&&(u.val(i.vid),i=e.extend({},i,{clone:u,field:t,term:c})),t.trigger("itemSelected",i),f.hide()}),f.find("."+o.prefix+"-preview-btn").on("click",function(){var t=e(this).closest("."+o.prefix+"-item").data("vid"),a=i("iframe",{vid:t});f.find("."+o.prefix+"-preview").addClass("show").show(),f.find("."+o.prefix+"-player").html(a)})}),e("."+o.prefix+"-btn-close-player").click(function(){return s(f),!1})})}}(jQuery);